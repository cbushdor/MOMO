<!DOCTYPE html>
<html>

<head>

	<!--
@author SÃ©bastien Dorey
file name: 20190723_soluce10_forms_Vue_JS_2.html
@email sebastien.dorey@laposte.net
@create date 2019-07-23 14:08:51
@modify date 2019-07-26 14:56:10
@desc Practising/Training on new FW VJS2
-->

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />

	<link rel="stylesheet" type="text/css" href="./css/style.css">:w
	<title>20190717_soluce09-bis_forms_Vue_JS_2</title>
</head>

<body>
	<div class="nav-bar"></div>

	<div id="app">
		<div class="cart">
			<p>Cart({{ cart.length }})</p>
		</div>

		<product :premium="premium" @add-to-cart="updateCart" @remove-from-cart="removeCart"></product>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>

	<script>
		//Add a new boolean data property `onSale` and create a computed property that takes `brand`, `product` and `onSale` and prints out a string whenever `onSale` is true.
		Vue.component('product-review', {
			template: `
				<form class="review-form" @submit.prevent="onSubmit">
					<p v-if="this.errors.length">
						<b>Please correct the following error(s) {{ this.errors.length }}</b>
						<ul v-for="error in errors">
							<li>{{ error }}</li>
						</ul>
					</p>
					<p>
						<label for="name">Name:</label>
						<textarea id="name" v-model="name"></textarea>
					</p>

					<p>
						<label for="review">Review:</label>
						<textarea id="review" v-model="review"></textarea>
					</p>

					<p>
						<label for="rating">Rating:</label>
						<select id="rating" v-model.number="rating">
							<option>5</option>
							<option>4</option>
							<option>3</option>
							<option>2</option>
							<option>1</option>
						</select>
					</p>

					<p>Would you like to recomend this product?</p>
					<label>
						Yes
						<input type="radio" id="recommend" value="yes" v-model="recommend">
					</label>
					<label>
						No
						<input type="radio" id="recommend" value="no" v-model="recommend">
					</label>
					
					<p>
						<input type="submit" value="Submit">
					</p>
				</form>
			`,
			data: function () {
				return {
					name: null,
					review: null,
					rating: null,
					recommend: null,
					errors: [],
				}
			},
			methods: {
				onSubmit: function () {
					if (this.name && this.review && this.rating && this.recommend) {
						let productReview = {
							name: this.name,
							review: this.review,
							rating: this.rating,
							recommend: this.recommend,
						}
						this.$emit('review-submitted', productReview)
						this.name = null
						this.review = null
						this.rating = null
						this.recommend = null
					}
					else {
						if (!this.name) { this.errors.push("Name required.") }
						if (!this.review) { this.errors.push("Review required.") }
						if (!this.rating) { this.errors.push("Rating required.") }
						if (!this.recommend) { this.errors.push("Recommandation required.") }
					}
				}
			}
		}),
			Vue.component('product', {
				props: {
					premium: {
						type: Boolean,
						required: true,
					}
				},
				template: `
						<div class="product">

							<div class="product-image">
								<img :src="image" />
							</div>

							<div class="product-info">

								<h1>{{ product }}</h1>
								<p>Shipping: {{ shipping }}</p>
								<p>{{ printBrand }}</p>

								<p v-if="inStock">In Stock</p>
								<p v-else>Out of Stock</p>

								<ul>
									<li v-for="detail in details">{{ detail }}</li>
								</ul>


								<div class="color-box" v-for="(variant, index) in variants" :key="variant.variantId"
									:style="{ backgroundColor: variant.variantColor }" @mouseover="updateProduct(index)">
								</div>

								<button v-on:click="addToCart" :disabled="!inStock" :class="{ disabledButton: !inStock }">
									Add to cart
								</button>

								<button v-on:click="removeFromCart" :disabled="!inStock" :class="{ disabledButton: !inStock }">
									Remove from cart
								</button>
								
								<div>
									<h2>Reviews</h2>
									<p v-if="!reviews.length">There are no review yet</p>
									<ul>
										<li v-for="review in reviews">
											<p>{{ review.name }}</p>
											<p>Rating: {{ review.rating }}</p>
											<p>Review: {{ review.review }}</p>
											<p>Recommend: {{ review.recommend }}</p>
										</li>
									</ul>
								</div>

								<product-review @review-submitted="addReview"></product-review>
							</div>
						</div>
			`,
				data: function () {
					return {
						product: 'Socks',
						brand: 'Vue Mastery',
						selectedVariant: 0,
						details: ['80% cotton', '20% polyester', 'Gender-neutral'],
						onSale: true,
						variants: [
							{
								variantId: 2234,
								variantColor: 'green',
								variantImage: './assets/vmSocks-green-onWhite.jpg',
								variantQuantity: 10
							},
							{
								variantId: 2235,
								variantColor: 'blue',
								variantImage: './assets/vmSocks-blue-onWhite.jpg',
								variantQuantity: 0
							}
						],
						reviews: [],
					}
				},
				methods: {
					addToCart: function () {
						this.$emit('add-to-cart', this.variants[this.selectedVariant].variantId)
					},
					removeFromCart: function () {
						this.$emit('remove-from-cart', this.variants[this.selectedVariant].variantId)
					},
					updateProduct: function (index) {
						this.selectedVariant = index
						console.log(index)
					},
					addReview: function (productReview) {
						this.reviews.push(productReview)
					},
				},
				computed: {
					title() {
						return this.brand + ' ' + this.product
					},
					image() {
						return this.variants[this.selectedVariant].variantImage
					},
					inStock() {
						if (this.variants[this.selectedVariant].variantQuantity > 0) {
							return true
						} else {
							return false
						}
					},
					shipping() {
						if (this.premium) {
							return "Free"
						} else {
							return 2.99
						}
					},
					printBrand() {
						return (this.onSale) ? this.brand : "-"
					}

				}
			})
		var app = new Vue({
			el: '#app',
			data: {
				premium: true,
				cart: [],
			},
			methods: {
				updateCart: function (id) {
					this.cart.push(id)
				},

				removeCart: function (id) {
					for (var i = this.cart.length - 1; i >= 0; i--) {
						if (this.cart[i] === id) {
							this.cart.splice(i, 1)
						}
					}
				}
			},
		})
	</script>
</body>

</html>